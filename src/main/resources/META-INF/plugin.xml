<!-- Plugin Configuration File: https://plugins.jetbrains.com/docs/intellij/plugin-configuration-file.html -->
<idea-plugin>
    <!-- Unique identifier of the plugin. It should be FQN, cannot be changed between the plugin versions. -->
    <id>de.espend.ml.llm</id>
    <version>0.4.0</version>

    <!-- Public plugin name should be written in Title Case.
         Guidelines: https://plugins.jetbrains.com/docs/marketplace/best-practices-for-listing.html#plugin-name -->
    <name>AI Assistant Providers / Sessions</name>

    <!-- A displayed Vendor name or Organization ID displayed on the Plugins Page. -->
    <vendor url="https://github.com/espend">espend</vendor>

    <!-- Description of the plugin displayed on the Plugin Page and IDE Plugin Manager.
         Guidelines: https://plugins.jetbrains.com/docs/marketplace/best-practices-for-listing.html#plugin-description -->
    <description><![CDATA[
        <p>Configure and use multiple AI providers as chat Agent in <del>IntelliJ IDEA's AI Assistant chat</del> (not allowed for now). Includes a Session Browser for viewing chat sessions from external AI tools.</p>

        <h2>AI Providers</h2>
        <p>This plugin allows you to configure multiple AI providers through a simple settings UI. Supports Claude CLI, Gemini CLI, OpenCode CLI, Cursor CLI, and any Anthropic-compatible API.</p>

        <h2>Session Browser</h2>
        <p>Browse and view chat sessions from external AI tools directly in the IDE.</p>

        <h3>Supported Session Sources</h3>
        <table>
            <tr><th>Source</th><th>Description</th></tr>
            <tr><td><b>Claude Code</b></td><td>Chat sessions from Claude Code CLI</td></tr>
            <tr><td><b>Codex CLI</b></td><td>Chat sessions from JetBrains AI Assistant CLI</td></tr>
            <tr><td><b>OpenCode</b></td><td>Chat sessions from OpenCode CLI</td></tr>
            <tr><td><b>Amp</b></td><td>Chat sessions from ampcode.com</td></tr>
        </table>

        <h3>Using AI Providers</h3>
        <ol>
            <li>Go to <b>File → Settings → AI Assistant → Agent Providers</b></li>
            <li>Configure API keys and base URLs as needed</li>
            <li>Click <b>Apply</b> to register the agents</li>
            <li>For CLI-based providers: install the corresponding npm package</li>
            <li><b>Important</b>: To use providers for core AI features (commit generation, AI actions):
                <ul>
                    <li>Go to <b>Settings → Tools → AI Assistant → "Models & API keys"</b></li>
                    <li>Select <b>"Agent Providers"</b> from the provider dropdown</li>
                    <li>Select a model from the model dropdown</li>
                </ul>
            </li>
        </ol>

        <h3>Finding the Session Browser</h3>
        <p>The Session Browser is available in the AI Assistant chat toolbar and in the right sidebar.</p>

        <p>Requires the AI Assistant plugin to be installed.</p>
    ]]></description>

    <!-- Product and plugin compatibility requirements.
         Read more: https://plugins.jetbrains.com/docs/intellij/plugin-compatibility.html -->
    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.ml.llm</depends>

    <!-- Extensions defined by the plugin.
         Read more: https://plugins.jetbrains.com/docs/intellij/plugin-extension-points.html -->
    <extensions defaultExtensionNs="com.intellij">
        <!-- AI Provider Agent Registry - dynamic agent registration -->
        <applicationService serviceImplementation="de.espend.ml.llm.AgentRegistry"/>

        <!-- Settings for AI provider agents - placed under AI Assistant -->
        <applicationConfigurable parentId="ml.llm.LLMConfigurable"
                                 id="de.espend.ml.llm.AgentSettings"
                                 instance="de.espend.ml.llm.AgentSettingsConfigurable"
                                 displayName="Agent Providers"
                                 groupWeight="10"/>

        <postStartupActivity implementation="de.espend.ml.llm.AgentStartupActivity"/>

        <!-- Session Browser Tool Window -->
        <toolWindow id="Session Browser"
                    factoryClass="de.espend.ml.llm.session.SessionBrowserToolWindowFactory"
                    anchor="right"
                    icon="/icons/ai-provider.svg"/>
    </extensions>

    <!-- Actions for AI Provider plugin -->
    <actions>
        <!-- Action to open Agent Providers settings from chat toolbar -->
        <action id="de.espend.ml.llm.OpenAgentProvidersSettings"
                class="de.espend.ml.llm.OpenAgentProvidersSettingsAction"
                text="Agent Providers"
                description="Open Agent Providers settings">
            <add-to-group group-id="AIAssistant.ToolWindow.Chat.SecondaryGearActions" anchor="after" relative-to-action="Acp.OpenConfiguration"/>
        </action>

        <!-- Action to open Session Browser from Tools menu -->
        <action id="de.espend.ml.llm.OpenSessionBrowser"
                class="de.espend.ml.llm.session.OpenSessionBrowserAction"
                text="AI Session Browser"
                description="Browse AI chat sessions">
            <add-to-group group-id="AIAssistant.ToolWindow.Chat.SecondaryGearActions" anchor="after" relative-to-action="Acp.OpenConfiguration"/>
        </action>
    </actions>
</idea-plugin>
